# CrazyBerry 游戏设计文档

## 项目概述

**CrazyBerry（疯狂草莓）** 是一款 3D 低多边形风格的种菜游戏，主要以种植红颜草莓为核心玩法，运行在 Web 浏览器中。

### 参考游戏
- Story of Seasons（牧场物语系列）
- Fae Farm
- Stardew Valley

### 目标平台
Web 浏览器（Three.js + WebGPU/WebGL2）

---

## 核心游戏循环

```
翻地 → 播种 → 浇水 → 等待生长 → 收获 → 出售 → 购买升级 → 扩展农场
 ↑                                                              |
 └──────────────────────────────────────────────────────────────┘
```

参考 Stardew Valley 的循环设计：每个动作都贡献进度和奖励感。循环简单但随游戏展开层层加深。

---

## 红颜草莓 - 品种特点

### 真实背景
- 1994年日本静冈县，由"章姬"和"幸香"杂交培育
- 果实圆锥形，深红色、富有光泽
- 可溶性固形物 11.8%，甜酸适口，香气浓郁
- 大果重 110g，均值单果重 15.3g

### 游戏内 5 个生长阶段

| 阶段 | 名称 | 游戏内天数 | 视觉表现 |
|------|------|-----------|---------|
| 1 | 种子期 | 第0天 | 土壤里的小种子（小黄褐色球体） |
| 2 | 发芽期 | 第1-2天 | 冒出两片小绿叶（绿色锥体+茎） |
| 3 | 生长期 | 第3-5天 | 茂盛的绿叶丛（多个绿色球体组合） |
| 4 | 开花期 | 第6-7天 | 白色小花朵（白色平面+黄色花蕊） |
| 5 | 结果期 | 第8-10天 | 深红色草莓果实（倒置红色锥体+绿色叶冠），可收获 |

---

## 3D 场景与视觉设计

### 相机
- 等距斜45°俯视角（Isometric-like）
- OrthographicCamera 或低 FOV PerspectiveCamera
- 固定角度俯瞰，可缩放但不可旋转

### 场景布局
- 中心：6x6 农田网格（可通过商店扩展）
- 周围：木质围栏装饰
- 底层：草绿色地面
- 角色在农田中自由移动

### Low-Poly 3D 模型（代码建模）

| 元素 | 建模方式 |
|------|---------|
| 土壤格子 | BoxGeometry + 棕色材质，翻地后颜色加深 |
| 种子 | 小 SphereGeometry，黄褐色 |
| 幼苗 | ConeGeometry 绿色 + 细 CylinderGeometry 茎 |
| 叶丛 | 多个 SphereGeometry 组合，深绿色 |
| 白花 | 小平面 CircleGeometry，白色 + 黄色花蕊 |
| 草莓果实 | ConeGeometry 倒置，深红色 + 绿色叶冠 |
| 角色 | CapsuleGeometry 身体 + SphereGeometry 头 + ConeGeometry 草帽 |
| 围栏 | CylinderGeometry 组合 |
| 地面 | PlaneGeometry 草绿色 |

### 光照系统
- AmbientLight：柔和环境光
- DirectionalLight：模拟太阳，随时间变化
  - 日间：暖黄色
  - 黄昏：橙红色
  - 夜间：深蓝色

---

## UI/UX 设计

### 设计原则
1. **渐进式展示** — 先呈现简洁界面，深度逐步解锁
2. **视觉即信息** — 用作物外观传达生长阶段，不依赖文字
3. **智能工具切换** — 借鉴 Fae Farm，靠近不同格子时自动切换合适工具
4. **最少干扰** — HUD 黄金法则：即时可读性

### UI 布局

```
┌─────────────────────────────────────────────┐
│                                             │
│  ┌─────────┐               ┌──────────────┐│
│  │ 第X天    │               │  💰 金币数   ││  ← 左上: 时间日期
│  │ ☀️ 上午  │               │  🍓 x 数量  ││  ← 右上: 金币+草莓数
│  └─────────┘               └──────────────┘│
│                                             │
│              (3D 游戏场景)                    │
│                                             │
│  ┌─────────────────────────────────────────┐│
│  │  [🪓] [🌰] [💧] [✋]    [💡提示] [🛒] ││  ← 底部工具栏
│  └─────────────────────────────────────────┘│
└─────────────────────────────────────────────┘
```

### 智能工具系统

靠近/点击不同状态的格子时，自动选择最合适的工具：

| 格子状态 | 自动选择的工具 | 动作 |
|---------|--------------|------|
| 草地（未开垦）| 锄头 | 翻地 |
| 空土壤（已翻地）| 种子袋 | 播种 |
| 已播种/生长中 | 浇水壶 | 浇水 |
| 成熟（红色草莓）| 手 | 收获 |
| 枯萎作物 | 铲子 | 清除 |

底部工具栏高亮当前工具，也支持手动切击强制切换。

### 交互方式
- **PC**：鼠标点击格子执行操作，WASD 移动角色
- **反馈**：每次操作有粒子效果 + 音效（浇水水花、收获星光等）

### 信息提示
- 作物头顶悬浮图标：💧 需浇水 / ⏰ 即将成熟 / ✅ 可收获
- 低金币温和提示
- 前3天新手引导步骤提示

### 商店 UI（弹窗式）

**购买区域：**
| 物品 | 价格 |
|------|------|
| 红颜草莓种子 | 10 金币 |
| 浇水壶升级 | 200 金币 |
| 扩展农田（+1行）| 500 金币 |

**出售区域（点击背包草莓即可出售）：**
| 物品 | 卖出价 |
|------|--------|
| 普通草莓 | 25 金币/个 |
| 优质草莓（概率产出）| 50 金币/个 |

---

## 游戏系统

### 时间系统
- 1 游戏天 = 现实 5 分钟（可调节）
- 日出 → 正午 → 黄昏 → 夜晚，光照平滑过渡
- 每天结束自动存档（localStorage）
- 右上角显示：第X天 | 上午/下午 | 天气图标

### 经济系统
- 初始金币：100
- 通过种植→收获→出售循环积累财富
- 可购买升级和扩展农田
- 优质草莓有一定概率产出（约20%）

### 存档系统
- 使用 localStorage 自动存档
- 存储内容：农田状态、金币数、天数、背包物品
- 每天结束 + 关闭页面时保存

---

## 技术架构

### 技术栈
| 技术 | 用途 |
|------|------|
| Three.js (r150+) | 3D 渲染引擎，ES Module |
| threejs-builder skill | 辅助构建场景 |
| InstancedMesh | 批量渲染农田格子和作物 |
| localStorage | 游戏存档 |
| HTML5 Audio API | 音效 |
| 纯 ES Module | 无打包工具，浏览器直接运行 |

### 文件结构

```
CrazyBerry/
├── index.html              ← 入口页面
├── src/
│   ├── main.js             ← 游戏入口，初始化 Three.js
│   ├── game/
│   │   ├── GameManager.js  ← 游戏主管理器（状态、循环）
│   │   ├── TimeSystem.js   ← 时间/日夜系统
│   │   ├── GridSystem.js   ← 农田网格管理
│   │   ├── CropSystem.js   ← 作物种植/生长逻辑
│   │   ├── ShopSystem.js   ← 商店/经济系统
│   │   └── SaveSystem.js   ← 存档管理
│   ├── entities/
│   │   ├── Player.js       ← 角色（模型+移动+动画）
│   │   ├── Strawberry.js   ← 红颜草莓（5阶段模型）
│   │   └── GridTile.js     ← 单个格子（状态+模型）
│   ├── rendering/
│   │   ├── SceneSetup.js   ← 场景/相机/光照
│   │   ├── Models.js       ← Low-poly 模型生成器
│   │   └── Effects.js      ← 粒子效果
│   ├── ui/
│   │   ├── HUD.js          ← 顶部状态栏
│   │   ├── Toolbar.js      ← 底部工具栏
│   │   └── ShopUI.js       ← 商店弹窗
│   └── utils/
│       ├── Constants.js    ← 游戏常量配置
│       └── Input.js        ← 键鼠输入处理
└── assets/
    └── sounds/             ← 音效文件
```

### 性能优化
- 农田格子用 InstancedMesh 一次绘制（减少 draw call）
- 作物模型用对象池复用
- requestAnimationFrame 时间驱动更新
- localStorage 存档防抖

---

## 开发阶段

| 阶段 | 内容 | 产出 |
|------|------|------|
| Phase 1 | 基础场景 + 农田网格 + 角色移动 | 能走动、看到农田 |
| Phase 2 | 种植系统 + 5阶段生长 + 智能工具 | 能种草莓、看它长大 |
| Phase 3 | 时间系统 + 日夜变化 + 浇水效果 | 有时间流逝感 |
| Phase 4 | 商店/经济 + 存档 + UI 完善 | 完整游戏循环 |
| Phase 5 | 粒子效果 + 音效 + 优化 + 打磨 | 手感好、有反馈 |
